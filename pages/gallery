<script>
    clearActiveMenu();
    $('#gallery-nav').addClass('nav-gallery-active');
    $('.content-top').attr("id", "gallery");
</script>

<div id="gallery-content" class="mCustomScrollbar _mCS_1">
    <div class="mCustomScrollBox mCS-light-thick" id="mCSB_1">
        <div class="mCSB_container" >
            <h1>GALLERY</h1> 
            
            <div id="gallery-items">
                <script id="gallery_template" type="x-tmpl-mustache">
                    <a class="fancybox" rel="gallery1" href="{{photo_url_abs}}">
                        <span class="gallery-thumbnail" style="background-image:url({{photo_url_abs}});"></span>
                    </a>
                </script>
            </div>
      
        </div>
    </div>
</div>



<script>
    
      $(document).ready(function() {
        
            function renderPageData(){
                //var repoList = getRepoDetailsByName('partners');
                var repoList = getRepoList();
                renderGallery('#gallery_template','#gallery-items',repoList);
            }
            loadMallDataCached(renderPageData);
            
            
            $("#gallery-content").mCustomScrollbar({
				scrollButtons:{
					enable:true
				},
				theme:"light-thick"
			});

        });
        
        
        
    function renderGallery(repo_template, gallery_item, repo){
        var item_list = [];
        var item_rendered = [];
        var repo_template_html = $(repo_template).html();
        Mustache.parse(repo_template_html);   // optional, speeds up future uses
        
        $.each( repo , function( key, val ) {
            if( val.name == "gallery"){
                $.each( val.images , function( key, val ) {
                    item_list.push(val);
                });
     
            }
            
        });
        item_list.sort(sortByDate);

        $.each( item_list , function( key, val ) {
            var repo_rendered = Mustache.render(repo_template_html,val);
            item_rendered.push(repo_rendered);
               
        });

        $(gallery_item).show();
        $(gallery_item).html(item_rendered.join(''));

    }
    
    function sortByDate(a, b){
       
    var aDate = a.updated_at;
    var bDate = b.updated_at;

    return ((aDate < bDate) ? -1 : ((aDate > bDate) ? 1 : 0));
}

</script>